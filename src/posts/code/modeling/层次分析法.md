---
title: 层次分析法(AHP)
date: 2024-03-03
icon: circle-info
---

## 概述

层次分析法（AHP）是美国运筹学家匹茨堡大学教授萨蒂(T.L.Saaty)于上世纪70年代初，为美国国防部研究“根据各个工业部门对国家福利的贡献大小而进行电力分配”课题时，应用网络系统理论和多目标综合评价方法，提出的一种层次权重决策分析方法。这种方法的特点是在对复杂的决策问题的本质、影响因素及其内在关系等进行深入分析的基础上，利用较少的定量信息使决策的思维过程数学化，从而为多目标、多准则或无结构特性的复杂决策问题提供简便的决策方法。是对难于完全定量的复杂系统作出决策的模型和方法。

层次分析法是一种解决多目标的复杂问题的定性与定量相结合的决策分析方法。该方法将定量分析与定性分析结合起来，用决策者的经验判断各衡量目标能否实现的标准之间的相对重要程度，并合理地给出每个决策方案的每个标准的权数，利用权数求出各方案的优劣次序，比较有效地应用于那些难以用定量方法解决的课题。

## 层次分析法的三大典型应用

- 用于最佳方案的选取(选择运动员，选择地址)
- 用于评价类问题(评价水质状况，评价环境)
- 用于指标体系的优选(兼顾科学和效率)

## 层次分析法的步骤和方法

### 运用层次分析法构造系统模型时，大体可以分为以下四个步骤：

- 建立层次结构模型
- 构造判断(成对比较)矩阵
- 层次单排序及其一致性检验
- 层次总排序及其一致性检验

### 1. 建立层次结构模型

将决策的目标、考虑的因素（决策准则）和决策对象按它们之间的相互关系分为最高层、中间层和最低层，绘出层次结构图。

- **最高层**：决策的目的、要解决的问题。

- **最低层**：决策时的备选方案。
- **中间层**：考虑的因素、决策的准则。

对于相邻的两层，称高层为**目标层**，低层为**因素层**。	

### 2. 构造判断(成对比较)矩阵

在确定各层次各因素之间的权重时，如果只是定性的结果，则常常不容易被别人接受，因而Santy等人提出：一致矩阵法，即：

1. 不把所有因素放在一起比较,而是两两相互比较
2. 对此时采用相对尺度,以尽可能减少性质不同的诸因素相互比较的困难,以提高准确度。

判断矩阵是表示本层所有因素针对上一层某一个因素的相对重要性的比较。判断矩阵的元素 $a_{ij}$，用Santy的1—9标度方法给出。
**心理学家认为成对比较的因素不宜超过9个，即每层不要超过9个因素。**

#### 判断矩阵元素$a_{ij}$的标度方法

|    标度    |                             含义                             |
| :--------: | :----------------------------------------------------------: |
|     1      |               表示两个因素相比，具有同样重要性               |
|     3      |       ′表示两个因素相比，一个因素比另一个因素稍微重要        |
|     5      |        表示两个因素相比，一个因素比另一个因素明显重要        |
|     7      |        表示两个因素相比，一个因素比另一个因素强烈重要        |
|     9      |        表示两个因素相比，一个因素比另一个因素极端重要        |
| 2，4，6，8 |                     上述两相邻判断的中值                     |
|    倒数    | 因素$i$与$j$比较的判断$a_{ij}$，则因素$j$与$i$比较的判断$a_{ji}=\frac{1}{a_{ij}}$ |

#### 一致性

$$
A=
\left[
\begin{matrix}
 1      & \frac{1}{2}      & 4 & 3  &	3     \\
 2      & 1      & 7 & 5   &5   \\
 \frac{1}{4} &  \frac{1}{7} & 1 &  \frac{1}{2}& \frac{1}{3} \\
  \frac{1}{3}      &  \frac{1}{5}      & 3 & 1&1      \\
\end{matrix}
\right]\\
要由A确定权向量，A是正互反矩阵\\
\color{red}{矩阵出现不一致的情况，比如a_{12}\cdot a_{23}\neq a_{13}}
$$

在一定范围内允许矩阵的不一致

如果完全一致为一致阵，此时A的秩为1，A的唯一非零特征根为n

非零特征根n所对应的特征向量归一化后可作为权向量对于不一致(但在允许范围内)的成对比较阵A，Santy等人建议用对应于最大特征根$\lambda$的特征向量作为权向量$\omega$，即$A\omega$ =$\lambda \omega$

 ### 3. 层次单排序及其一致性检验

对应于判断矩阵最大特征根$\lambda_{max}$的特征向量，经归一化(使向量中各元素之和等于1)后记为$W$。

$W$的元素为同一层次因素对于上一层次因素某因素相对重要性的排序权值,这一过程称为层次单排序。

能否确认层次单排序，需要进行一致性检验，所谓一致性检验是指对A确定不一致的允许范围。

- 定理: $n$阶一致阵的唯一非零特征根为$n$

- 定理:$n$阶正互反阵$A$的最大特征根$\lambda\geq n$，当且仅当$\lambda= n$时A的为一致阵

由于$\lambda$连续的依赖于$a_{ij}$，则$\lambda$比n大的越多，A的不一致性越严重。用最大特征值对应的特征向量作为被比较因素对上层某因素影响程度的权向量，其不一致程度越大，引起的判断误差越大。因而可以用无$\lambda-n$数值的大小来衡量A的不一致程度。
$$
定义一致性指标：CI=\frac{\lambda-n}{n-1}\\
CI=0,有完全的一致性\\
CI接近于0,有满意的一致性\\
CI越大,不一致越严重a
$$
为衡量CI的大小，引入随机一致性指标RI。

方法为随机构造500个成对比较矩阵$\quad A_1,A_2,\cdots,A_{500}$

则可得一致性指标$\quad CI_1,CI_2,\cdots,CI_{500}$
$$
RI=\frac{CI_1+CI_2+\cdots+CI_{500}}{500}=\frac{\frac{\lambda_1+\lambda_2+\cdots+\lambda_{500}}{500}-n}{n-1}
$$

Santa的结果如下
随机一致性指标RI

|  n   |  1   |  2   |  3   |  4   |  5   |  6   |  7   |  8   |  9   |  20  |  11  |
| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
|  RI  |  0   |  0   | 0.58 | 0.90 | 1.12 | 1.24 | 1.32 | 1.41 | 1.45 | 1.49 | 1.51 |

$$
定义一致性比率：CR=\frac{CI}{RI}\\
一般，当一致性比率 CR=\frac{CI}{RI}<0.1时\\
认为A的不一致程度在容许范围之内，有满意的一致性，通过一致性检验\\
可用其归一化特征向量作为权向量，否则要重新构造成对比较矩阵A，对a_{ij}加以调整。\\
一致性检验:利用一致性指标和一致性比率<0.1及随机一致性指标的数值表，对A进行检验的过程。
$$

#### 正互反阵最大特征根和特征向量的简化计算

$$
A=\left[
\begin{matrix}
 1      & 2      & 6     \\
 \frac{1}{2}      & 1      & 4    \\
 \frac{1}{6} &  \frac{1}{4} & 1  \\
\end{matrix}
\right]
\overset{列向量归一化}{\Rightarrow}
\left[
\begin{matrix}
 0.6      & 0.615      & 0.545     \\
 0.3     & 0.308      & 0.364    \\
 0.1 &  0.077 & 0.091  \\
\end{matrix}
\right]
\overset{求行和归一化}{\Rightarrow}
\left[
\begin{matrix}
 0.587  \\
 0.324  \\
 0.089  \\
\end{matrix}
\right]=\omega\\
A\omega=\left[
\begin{matrix}
1.769  \\
0.974  \\
0.268  \\
\end{matrix}
\right]
\overset{A\omega=\lambda \omega}{\Rightarrow}
\lambda=\frac{1}{3}(\frac{1.769}{0.587}+\frac{0.974}{0.324}+\frac{0.268}{0.089})=3.009\\
精确结果：\omega=(0.588,0.322,0.090)^T,\lambda=3.010
$$

### 4. 层次总排序及其一致性检验
- 计算某一层次所有因素对于最高层(总目标)相对重要性的权值，称为层次总排序。
- 这一过程是从最高层次到最低层次依次进行的。

#### 层次总排序的一致性检验
设$B$层$B_1,B_2,,\cdots,B_n$对上层(A层)中因素$A_j(j = 1,2,\cdots,m)$的层次单排序一致性指标为$CI_j$ ,随机一致性指标$RI_j$,,则层次总排序的一致性比率为:
$$
CR=\frac{a_1CI_1+a_2CI_2+\cdots+a_mCI_m}{a_1RI_1+a_2RI_2+\cdots+a_mRI_m}
$$
当$CR<0.1$时，认为层次总排序通过一致性检验。层次总排序具有满意的一致性，否则需要重新调整那些一致性比率高的判断矩阵的元素取值。
到此，根据最下层(决策层)的层次总排序做出最后决策。

## 案例 选拔优秀参赛队员问题

### 1.  问题的提出

设某学校数学建模教练组根据实际需要，拟从报名参赛的20名队员中选出15名优秀队员代表学校参赛。表1给出了20名队员的基本条件的量化情况。请根据这些条件对20名队员进行综合评价，从中选出15名综合素质较高的优秀队员。

<center><h3>
表一 各队员的主要条件
</h3></center>


|   队员   | 学科知识竞赛成绩$r_i^{(1)}$ | 思维敏捷度$r_i^{(2)}$ | 知识面宽广度$r_i^{(3)}$ | 写作能力$r_i^{(4)}$ | 计算机应用能力$r_i^{(5)}$ | 团队协作能力$r_i^{(6)}$ |
| :------: | :-------------------------: | :-------------------: | :---------------------: | :-----------------: | :-----------------------: | :---------------------: |
|  $S_1$   |             86              |          9.0          |           8.2           |         8.0         |            7.9            |           9.5           |
|  $S_2$   |             82              |          8.8          |           8.1           |         6.5         |            7.7            |           9.1           |
|  $S_3$   |             80              |          8.6          |           8.5           |         8.5         |            9.2            |           9.6           |
|  $S_4$   |             85              |          8.9          |           8.3           |         9.6         |            9.7            |           9.7           |
|  $S_5$   |             88              |          8.4          |           8.5           |         7.7         |            8.6            |           9.2           |
|  $S_6$   |             92              |          9.2          |           8.2           |         7.9         |            9.0            |           9.0           |
|  $S_7$   |             92              |          9.6          |           9.0           |         7.2         |            9.1            |           9.2           |
|  $S_8$   |             92              |          8.0          |           9.8           |         6.2         |            8.7            |           9.7           |
|  $S_9$   |             70              |          8.2          |           8.4           |         6.5         |            9.6            |           9.3           |
| $S_{10}$ |             77              |          8.1          |           8.6           |         6.9         |            8.5            |           9.4           |
| $S_{11}$ |             83              |          8.2          |           8.0           |         7.8         |            9.0            |           9.2           |
| $S_{12}$ |             90              |          9.1          |           8.1           |         9.9         |            8.7            |           9.5           |
| $S_{13}$ |             96              |          9.6          |           8.3           |         8.1         |            9.0            |           9.7           |
| $S_{14}$ |             95              |          8.3          |           8.2           |         8.1         |            8.8            |           9.3           |
| $S_{15}$ |             86              |          8.3          |           8.8           |         8.4         |            8.6            |           9.0           |
| $S_{16}$ |             91              |          8.0          |           8.6           |         8.8         |            8.4            |           9.4           |
| $S_{17}$ |             93              |          8.7          |           9.4           |         9.2         |            8.7            |           9.5           |
| $S_{18}$ |             84              |          8.4          |           9.2           |         9.1         |            7.8            |           9.1           |
| $S_{19}$ |             87              |          8.3          |           9.5           |         7.9         |            9.0            |           9.6           |
| $S_{20}$ |             78              |          8.1          |           9.6           |         7.6         |            9.0            |           9.2           |

### 2. 问题的分析与假设

这是一个半定性与半定量、多因素的综合选优排序问题.鉴于数学建模竞赛不仅要考查学生的学科知识、还要考查学生的写作能力、计算机应用能力、团结协助能力等多方面的因素，要从20名队员中选拔出优秀参赛队员，就要对表1中所列的六个因素进行比较分析，综合排序选优。
模型的假设:

1. 题目中所确定的考评条件是合理的，能够反映出参选队员的建模能力;
2. 各参选队员的量化得分是按统一的量化标准得出的;
3. 对参选队员的量化打分是公平的，所有参选队员对打分结果无异议;
4. 选拔队员所考八尔r球 ，知识面宽广度、写作能依次为学科知识竞赛成绩、思维敏捷度、知识面宽广度、写作能力、计算机应用能力、团结协助能力，并且相邻两个因素的影响程度之差基本相同;

### 3. 模型的建立与求解

#### 建立如下图所示的层次结构图

1. 第一层为目标层:选拔优秀参赛队员;
2. 第二层为准则层:选拔优秀队员时所考虑的6个因素，依次为学科知识竞赛成绩、思维敏捷度、知识面宽广度、写作能力、计算机应用能力、协助能力;
3. 第三层为方案层:参选的20名队员.

#### 确定准则层对目标层的权重向量

根据假设，构造准则层C对目标层О的两两比较矩阵:
$$
A=
\left[
\begin{matrix}
 1      & 2      & 3 & 4  &	5&6     \\
 \frac{1}{2}      & 1      & 2 & 3   &4&5   \\
 \frac{1}{3} &  \frac{1}{2} & 1 &2& 3&4 \\
  \frac{1}{4}      &  \frac{1}{3}      &  \frac{1}{2} & 1&2&3      \\
 \frac{1}{5} &\frac{1}{4}      &  \frac{1}{3}      &  \frac{1}{2} & 1&2      \\
 \frac{1}{6}&\frac{1}{5} &\frac{1}{4}      &  \frac{1}{3}      &  \frac{1}{2} & 1
\end{matrix}
\right]
$$
这是一个6阶的正反矩阵，用和法计算A的最大特征根为： $\lambda_{max}=6.1232$，相应归一化特征向量为：
$$
\omega^{(2)}=(0.3794,0.2488,0.1604,0.1024,0.0655,0.0434)^T
$$
一致性指标$CI^{(2)}=0.0246$，随机一致性指标$RI^{(2)}=1.24$，一致性比率$CR^{(2)}=0.0198<0.1$通过一致性检验，$\omega^{(2)}$为准则层对目标层的权重向量

#### 确立方案层对准则层的权重向量

根据表1和模型假设，构造方案层$P$中20个队员对准则层$C$中各因素$C_k$的两两比较矩阵
$$
B_k=(b_{ij})^{(k)}_{20\times20},其中b_{ij}^{(k)}=\frac{r_i^{(k)}}{r_j^{(k)}},(i,j=1,2,\cdots,20,k=1,2,\cdots,6)
$$
显然，所有的$B_k$均为一致阵，于是$B_k$的最大特征根为
$$
\lambda_{max}^{(k)}=20,CI_k=0,CR_k=0
$$

#### 确定方案层P对目标层O的组合权重向量

方案层对目标层的组合权重向量为：
$$
\omega^{(3)}=W^{(3)}\omega^{(2)}=(0.0498,0.0474,0.0490,0.0513,\\
0.0497,0.0517,0.0526,0.0504,\\
0.0450,0.0464,0.0480,0.0523,\\
0.0535,0.0511,0.0496,0.0505,\\
0.0531,0.0500,0.0506,0.0481)^T
$$
组合一致性指标$CI^{(3)}=0$，组合一致性比率为：
$$
CR^{(3)}=CR^{(2)}+\frac{CI^{(3)}}{RI^{(3)}}=0.0198<0.1
$$
通过一致性检验，组合群众$\omega^{(3)}$可作为决策依据

将权重$\omega^{(3)}$的20个分量分别作为20名队员的综合实力，从大到依次为

$S_{13},S_{17},S_{7},S_{12},S_{6},S_{4}, S_{14},S_{19},S_{16},S_{8},S_{18},S_{1},S_{5},S_{15},S_{3},S_{20},S_{11},S_{2},S_{10},S_{9}$​

根据排名结果，淘汰最后5名队员

$S_{20},S_{11},S_{2},S_{10},S_{9}$

### 4. 模型的结果分析与推广

1. 由表1，20名队员六项条件互有强弱，利用层次分析法得到了一种合理的综合排序方案，结果选出了综合实力较强的15名队员，第13号队员各项条件总体较强，排在了第一位;第9号和第10号队员各项条件总体较弱，排在后两位.
2. 该模型还可以应用到三好学生的评选问题、旅游景点的选择问题、综合实力的评价分析问题等.

### 5. 层次分析法的优点

1. 系统性．把所研究的问题看成一个系统，按照分解、比较判断、综合分析的思维方式进行决策分析，也是实际中继机理分析方法、统计分析方法之后发展起来的又一个重要的系统分析工具.

2. 实用性．把定性与定量方法结合起来，能处理许多传统的优化方法无法处理的实际问题，应用范围广．而且将决策联系起来，体现了决策者的主观意见，决策者可以直接应用它进行决策分析，增加了决策的有效性和实用性.

3. 简洁性．具有中等文化程度的人都可以学习掌握层次分析法的基本原理和步骤，计算也比较简便，所得结果简单明确，容易被决策者了解和掌握.

### 6. 层次分析法的局限性

1. 局限性是粗略、主观．首先是它的比较、判断及结果都是粗糙的，不适于精度要求很高的问题.
2. 其次是从建立层次结构图到给出两两比较矩阵，人的主观因素作用很大，使决策结果较大程度地依赖于决策人的主观意志，可能难以为众人所接受.

## 待补充：代码和关于一致性检验的总结

